<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoxPay - Music Preview Marketplace</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* TEMA GELAP */
        :root {
            --primary: #8b5cf6;
            --primary-light: rgba(139, 92, 246, 0.1);
            --secondary: #d946ef;
            --dark: #ffffff;
            --light: #080a12;
            --white: #111625;
            --gray: #8b949e;
            --hero-music: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            --bg-gradient: linear-gradient(180deg, #080a12 0%, #111625 100%);
            --avatar-gradient: linear-gradient(45deg, #8b5cf6, #d946ef, #00d2ff);
            --btn-home-bg: linear-gradient(135deg, #8b5cf6 0%, #d946ef 100%);
            --btn-buy-bg: #1e293b; 
            --accent-new: #ff3e3e;
            --gold: #ffd700;
            --gold-gradient: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
        }

        /* --- UPDATE: STYLE UNTUK EXCLUSIVE BOX (ELEGAN & LUXURY) --- */
        .card-exclusive {
            border: 1px solid rgba(255, 215, 0, 0.3) !important;
            background: linear-gradient(165deg, #111625 0%, #1a1a1a 100%) !important;
            position: relative;
            overflow: hidden;
        }
        .card-exclusive::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 2px;
            background: var(--gold-gradient);
            z-index: 3;
        }
        .card-exclusive .new-badge {
            background: var(--gold-gradient) !important;
            color: #4a3701 !important;
            font-weight: 900;
            letter-spacing: 0.5px;
            box-shadow: -2px 2px 10px rgba(0,0,0,0.5);
        }
        .card-exclusive .project-info b {
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        }
        .card-exclusive .project-info span {
            color: #fcf6ba !important;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
        }
        .card-exclusive .play-btn-mini {
            background: var(--gold-gradient) !important;
            box-shadow: 0 4px 15px rgba(191, 149, 63, 0.4);
        }
        .card-exclusive .play-btn-mini svg {
            fill: #4a3701 !important;
        }
        .card-exclusive .wave-bar.active {
            background: #bf953f !important;
        }
        .card-exclusive .btn-buy {
            border: 1px solid #bf953f !important;
            background: rgba(191, 149, 63, 0.1) !important;
            color: #fcf6ba !important;
        }

        /* STYLE UNTUK SOLD OUT */
        .is-sold-out {
            filter: grayscale(0.8);
            opacity: 0.8;
            pointer-events: none; /* Mencegah klik tapi preview audio tetap bisa lewat ID */
        }
        .is-sold-out .play-btn-mini {
            pointer-events: auto !important; /* Supaya preview audio tetap bisa diputar */
        }
        .btn-sold-out {
            background: #334155 !important;
            color: #94a3b8 !important;
            cursor: not-allowed !important;
            border: none !important;
        }

        /* --- SPLASH SCREEN ANIMATION --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #080a12; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.8s ease, visibility 0.8s;
        }
        .splash-logo {
            width: 80px; height: 80px; background: var(--hero-music);
            border-radius: 20px; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 35px; font-weight: 800;
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
            animation: pulseLogo 1.5s infinite ease-in-out;
        }
        @keyframes pulseLogo {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        .splash-text { margin-top: 20px; color: white; font-weight: 800; letter-spacing: 2px; font-size: 14px; opacity: 0.8; }
        .hide-splash { opacity: 0; visibility: hidden; }

        /* Base Reset */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; scroll-behavior: smooth; }
        
        body { background: var(--bg-gradient); min-height: 100vh; color: var(--dark); overflow-x: hidden; }
        .container { padding: 0 16px; width: 100%; max-width: 500px; margin: 0 auto; position: relative; }

        header { 
            background: rgba(17, 22, 37, 0.8); backdrop-filter: blur(15px); 
            padding: 12px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.08); 
            position: sticky; top: 0; z-index: 1000; 
        }
        .header-flex { display: flex; justify-content: space-between; align-items: center; }
        .logo-nav { display: flex; align-items: center; gap: 8px; cursor: pointer; position: relative; }
        .logo-box { width: 32px; height: 32px; background: var(--hero-music); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 800; font-size: 14px; position: relative; }

        /* NOTIFIKASI TITIK MERAH */
        .notif-dot { 
            position: absolute; top: -3px; right: -3px; width: 10px; height: 10px; 
            background: #ff3e3e; border: 2px solid #111625; border-radius: 50%; 
            display: none; z-index: 10; animation: pulseRed 1.5s infinite;
        }
        @keyframes pulseRed { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 62, 62, 0.7); } 70% { transform: scale(1.2); box-shadow: 0 0 0 6px rgba(255, 62, 62, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 62, 62, 0); } }

        #creator-sidebar {
            position: fixed; top: 0; left: -280px; width: 280px; height: 100%;
            background: var(--white); z-index: 5001; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 10px 0 30px rgba(0,0,0,0.5); padding: 30px 20px;
            display: flex; flex-direction: column;
        }
        #creator-sidebar.active { left: 0; }
        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
            z-index: 5000; display: none; opacity: 0; transition: 0.3s;
        }

        /* --- NEW PROFILE STYLES --- */
        .profile-section { text-align: center; margin: 25px 0 15px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .profile-avatar-container { width: 85px; height: 85px; margin: 0 auto 15px; background: var(--avatar-gradient); padding: 3px; border-radius: 25px; box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3); }
        .profile-avatar-container img { width: 100%; height: 100%; border-radius: 22px; background: var(--white); object-fit: cover; }
        .profile-name { font-weight: 800; font-size: 16px; color: white; margin-bottom: 5px; }
        .profile-role { font-size: 10px; font-weight: 800; color: var(--gold); letter-spacing: 1px; text-transform: uppercase; }

        #user-id-display {
            display: block; margin-top: 10px; padding: 14px; background: rgba(139, 92, 246, 0.05); border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 16px; color: #a5b4fc; font-family: monospace; font-size: 11px; line-height: 1.5; word-break: break-all; text-align: center; cursor: pointer; transition: 0.3s; box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
        }

        /* Menu Sidebar Baru */
        .sidebar-menu-list { list-style: none; margin-top: 20px; }
        .menu-item { display: flex; align-items: center; gap: 12px; padding: 14px; color: var(--gray); text-decoration: none; font-weight: 700; font-size: 13px; border-radius: 14px; transition: 0.3s; margin-bottom: 5px; position: relative; }
        .menu-item:hover { background: rgba(255,255,255,0.05); color: white; }
        .menu-item svg { width: 18px; height: 18px; opacity: 0.7; }

        .btn-register-sidebar { display: block; text-align: center; font-size: 12px; font-weight: 800; text-decoration: none; padding: 14px; border-radius: 16px; transition: 0.3s; letter-spacing: 0.5px; margin-top: 10px; cursor: pointer; border: none; }
        #btn-daftar { color: var(--primary); border: 1.5px solid var(--primary); background: rgba(139, 92, 246, 0.05); }
        #btn-upload { background: linear-gradient(135deg, #8b5cf6 0%, #d946ef 100%) !important; color: white !important; box-shadow: 0 8px 20px rgba(139, 92, 246, 0.3); }
        .btn-logout { background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1.5px solid rgba(239, 68, 68, 0.3); }

        .btn-upload-prominent { display: flex; align-items: center; gap: 12px; padding: 16px; border-radius: 18px; margin-top: 20px; cursor: pointer; background: var(--hero-music); color: white !important; font-weight: 800; font-size: 13px; letter-spacing: 0.2px; box-shadow: 0 8px 15px rgba(0,0,0,0.3); transition: all 0.3s ease; border: none; text-decoration: none; }
        .btn-home-header { background: var(--btn-home-bg); color: white; text-decoration: none; padding: 6px 12px; border-radius: 10px; font-size: 11px; font-weight: 800; }
        .btn-guide-header { background: transparent; color: var(--primary); border: 1.5px solid var(--primary); text-decoration: none; padding: 5px 10px; border-radius: 10px; font-size: 11px; font-weight: 800; margin-right: 6px; cursor: pointer; }
        .hero { position: relative; background: #111827; color: white; padding: 35px 0 45px; border-radius: 0 0 40px 40px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 15px 30px rgba(0,0,0,0.4); }
        .hero-glow-1 { position: absolute; top: -50px; right: -30px; width: 180px; height: 180px; background: var(--primary); filter: blur(80px); opacity: 0.4; border-radius: 50%; }
        .hero-glow-2 { position: absolute; bottom: -30px; left: -30px; width: 150px; height: 150px; background: var(--secondary); filter: blur(70px); opacity: 0.3; border-radius: 50%; }
        .hero-content { position: relative; z-index: 10; }
        .badge-premium { background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); padding: 5px 12px; border-radius: 100px; font-size: 9px; font-weight: 800; display: inline-flex; align-items: center; gap: 5px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 12px; }
        .badge-dot { width: 5px; height: 5px; background: #10b981; border-radius: 50%; box-shadow: 0 0 8px #10b981; animation: blink 1.5s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        .hero h2 { font-size: 28px; font-weight: 800; line-height: 1.1; letter-spacing: -0.5px; }
        .hero p { font-size: 12px; opacity: 0.7; width: 70%; margin-top: 8px; line-height: 1.4; }
        .hero-character { position: absolute; right: -10px; bottom: -5px; width: 140px; z-index: 5; pointer-events: none; }
        @keyframes floating { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-10px) rotate(2deg); } }
        .section-header { margin: 20px 0 12px; display: flex; justify-content: space-between; align-items: center; }
        .section-header h2 { font-size: 15px; font-weight: 800; display: flex; align-items: center; gap: 8px; color: white; }
        .section-header h2::before { content: ''; width: 5px; height: 15px; background: var(--primary); border-radius: 10px; }
        .project-card { background: var(--white); padding: 16px; border-radius: 24px; display: flex; flex-direction: column; gap: 12px; margin-bottom: 16px; border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 8px 20px rgba(0,0,0,0.2); position: relative; overflow: hidden; animation: cardEntrance 0.7s cubic-bezier(0.16, 1, 0.3, 1) both; }
        @keyframes cardEntrance { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .card-main-info { display: flex; align-items: center; gap: 12px; width: 100%; }
        .new-badge { position: absolute; top: 0; right: 0; background: var(--accent-new); color: white; font-size: 8px; font-weight: 900; padding: 4px 10px; border-radius: 0 0 0 15px; z-index: 2; }
        .project-img-container { position: relative; width: 65px; height: 65px; flex-shrink: 0; cursor: pointer; }
        .project-img-box { width: 100%; height: 100%; border-radius: 16px; background: #1e293b; overflow: hidden; }
        .project-img-box img { width: 100%; height: 100%; object-fit: cover; }
        .play-btn-mini { width: 32px; height: 32px; background: var(--primary); border-radius: 10px; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; flex-shrink: 0; }
        .play-btn-mini svg { width: 16px; height: 16px; fill: white; }
        .project-info { flex: 1; }
        .project-info b { font-size: 13px; display: block; margin-bottom: 2px; color: white; padding-right: 20px; line-height: 1.2; }
        .project-info span { font-size: 14px; color: var(--primary); font-weight: 800; }
        .btn-buy { background: var(--btn-buy-bg); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 10px 16px; border-radius: 14px; font-weight: 700; font-size: 10px; cursor: pointer; transition: 0.3s; }
        .btn-download-premium { background: #10b981; color: white; text-decoration: none; padding: 10px; border-radius: 14px; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 15px rgba(16, 185, 129, 0.4); border: none; cursor: pointer; animation: pulseGlow 2s infinite; }
        @keyframes pulseGlow { 0% { box-shadow: 0 0 5px rgba(16, 185, 129, 0.4); } 50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.7); } 100% { box-shadow: 0 0 5px rgba(16, 185, 129, 0.4); } }
        .player-controls { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 16px; display: flex; align-items: center; gap: 12px; margin-top: 4px; border: 1px solid rgba(255,255,255,0.05); }
        .waveform-container { flex: 1; height: 24px; display: flex; align-items: center; gap: 3px; cursor: pointer; position: relative; }
        .wave-bar { flex: 1; height: 40%; background: rgba(255, 255, 255, 0.2); border-radius: 10px; transition: height 0.2s ease, background 0.3s ease; }
        .wave-bar.active { background: var(--primary); }
        
        /* --- ANIMASI MELEKOK MELEKEK --- */
        .playing .wave-bar { animation: waveAnimation 0.6s ease-in-out infinite alternate; }
        .playing .wave-bar:nth-child(2n) { animation-delay: 0.1s; animation-duration: 0.5s; }
        .playing .wave-bar:nth-child(3n) { animation-delay: 0.2s; animation-duration: 0.7s; }
        .playing .wave-bar:nth-child(4n) { animation-delay: 0.3s; animation-duration: 0.6s; }
        
        @keyframes waveAnimation { 
            0% { height: 30%; transform: scaleY(1); } 
            100% { height: 100%; transform: scaleY(1.2); } 
        }

        .time-display { font-size: 9px; color: var(--gray); font-weight: 700; min-width: 30px; text-align: right; }
        .category-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .creator-card { background: var(--white); padding: 20px 10px; border-radius: 24px; text-align: center; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        .avatar-wrapper { width: 70px; height: 70px; margin: 0 auto 10px; background: var(--avatar-gradient); padding: 2px; border-radius: 50%; }
        .creator-card img { width: 100%; height: 100%; border-radius: 50%; border: 2px solid #111625; object-fit: cover; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); display: none; align-items: flex-end; z-index: 2000; }
        #modal-info { align-items: center; justify-content: center; } 
        #modal-info .modal-content { border-radius: 30px; margin: 0 16px; width: calc(100% - 32px); }
        .modal-content { background: #111625; width: 100%; max-width: 500px; margin: 0 auto; border-radius: 30px 30px 0 0; padding: 24px; border: 1px solid rgba(255,255,255,0.1); }
        .form-control { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #333; background: #080a12; color: white; font-weight: 700; margin-bottom: 15px; outline: none; }
        .hidden { display: none !important; }
        .item-get-box { background: rgba(139, 92, 246, 0.05); border: 1px dashed var(--primary); padding: 12px; border-radius: 15px; margin-bottom: 20px; }
        .item-get-title { font-size: 10px; color: var(--primary); font-weight: 800; letter-spacing: 1px; margin-bottom: 8px; display: block; }
        .item-list { list-style: none; }
        .item-list li { font-size: 11px; color: var(--gray); display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
        .item-list li::before { content: 'âœ“'; color: #10b981; font-weight: 900; }
        .payment-dana-box { background: #1d4ed8; padding: 15px; border-radius: 18px; display: flex; align-items: center; gap: 12px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .dana-logo { background: white; width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 900; color: #1d4ed8; font-size: 10px; flex-shrink: 0; }
        .dana-info { flex: 1; }
        .dana-info p { font-size: 8px; color: rgba(255,255,255,0.7); font-weight: 700; letter-spacing: 0.5px; }
        .dana-info b { font-size: 13px; color: white; letter-spacing: 1px; }
        .btn-baca { background: var(--hero-music); color: white; border: none; padding: 6px 15px; border-radius: 10px; font-size: 10px; font-weight: 800; cursor: pointer; margin-right: 8px; box-shadow: 0 4px 10px rgba(139, 92, 246, 0.3); transition: transform 0.2s; display: none; }
        .info-box-content { background: rgba(139, 92, 246, 0.05); border: 1px solid rgba(139, 92, 246, 0.2); padding: 15px; border-radius: 15px; color: var(--gray); font-size: 12px; line-height: 1.6; }
        .sidebar-footer { margin-top: auto; padding-top: 20px; }
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="splash-logo">N</div>
        <div class="splash-text">NOXPAY MUSIC</div>
    </div>

    <div id="sidebar-overlay-creator" class="sidebar-overlay" onclick="toggleSidebarCreator()"></div>
    <div id="creator-sidebar">
        <div style="display: flex; align-items: center; gap: 10px; color: white;">
            <div class="logo-box">N</div>
            <b style="font-size: 16px;">Menu Navigasi</b>
        </div>

        <div class="profile-section">
            <div class="profile-avatar-container">
                <img id="sidebar-avatar" src="https://api.dicebear.com/7.x/notionists/svg?seed=Guest&backgroundColor=b6e3f4">
            </div>
            <div id="sidebar-user-name" class="profile-name">Guest User</div>
            <div id="sidebar-user-role" class="profile-role">MEMBER</div>
            <b id="user-id-display" title="Klik untuk menyalin" onclick="copyID()">Memuat ID...</b>
        </div>

        <div class="sidebar-menu-list">
            <a href="library.html" class="menu-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                Library Saya
            </a>
            <a href="dasbor.html" id="menu-dashboard" class="menu-item" style="display: none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>
                Dashboard Creator
                <div id="dot-dashboard" class="notif-dot" style="top: 12px; right: 12px;"></div>
            </a>
        </div>

        <div class="sidebar-footer">
            <a href="daftar-creator.html" id="btn-daftar" class="btn-register-sidebar">DAFTAR JADI CREATOR</a>
            <a href="upload-produk.html" id="btn-upload" class="btn-register-sidebar" style="display: none;">UPLOAD PRODUK</a>
            <button id="btn-logout" class="btn-register-sidebar btn-logout" style="display: none; width:100%;" onclick="handleLogout()">KELUAR AKUN</button>
        </div>
    </div>

    <header>
        <div class="container header-flex">
            <div class="logo-nav" onclick="toggleSidebarCreator()">
                <div class="logo-box">
                    N
                    <div id="dot-header" class="notif-dot"></div>
                </div>
                <div style="font-weight: 800; font-size: 16px; color:white;">Nox<span style="color:var(--primary)">Music</span></div>
            </div>
            <div>
                <button class="btn-guide-header" onclick="alert('Tutorial Upload sedang disiapkan!')">Cara Upload</button>
                <a href="index.html" class="btn-home-header">Beranda</a>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="hero-glow-1"></div>
        <div class="hero-glow-2"></div>
        <div class="container hero-content">
            <div class="badge-premium">
                <div class="badge-dot"></div>
                <span>DARK PREMIUM SYSTEM</span>
            </div>
            <h2>Project <br><span style="color:var(--primary)">Fl Studio Mobile!</span></h2>
            <p>Beli woyyyyy apalah liat2 doang.</p>
        </div>
    </section>

    <main class="container">
        <div id="creator-section">
            <div class="section-header"><h2>Pilih Kreator</h2></div>
            <div class="category-grid" id="creator-list-render">
                <p style="color:var(--gray); font-size:12px; text-align:center; grid-column: span 2;">Memuat creator...</p>
            </div>
        </div>

        <div id="project-section" class="hidden">
            <div class="section-header">
                <h2>Karya <span id="creator-name-display" style="color:var(--primary)"></span></h2>
                <div style="display: flex; align-items: center;">
                    <button id="btn-baca-info" class="btn-baca" onclick="openInfoBox()">BACA</button>
                    <button onclick="showCreators()" style="background:transparent; border:1.5px solid var(--primary); color:var(--primary); padding:6px 12px; border-radius:10px; font-size:10px; font-weight:800; cursor:pointer;">GANTI</button>
                </div>
            </div>
            <div id="project-render"></div>
        </div>
    </main>

    <div id="modal-info" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-bottom:18px; font-weight:800; color:white;">Informasi</h3>
            <div class="info-box-content">
                Kenapa harganya murah??,karena project yang saya jual tidak panjang/full,jadi cuma bagan nya saja ya mek.
                SETELAH MELAKUKAN PEMBAYARAN DAN SUDAH DI KONFIRMASI OLEH ADMIN OTOMATIA TOMBOL DOWNLOAD AKAN MUNCUL!!.
            </div>
            <button onclick="closeModalGeneric('modal-info')" style="background:var(--primary); color:white; width:100%; padding:16px; border-radius:18px; border:none; font-weight:800; margin-top:20px;">Tutup</button>
        </div>
    </div>

    <div id="modal-detail" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-bottom:18px; font-weight:800; color:white;">Konfirmasi Beli</h3>
            <div style="background:rgba(255,255,255,0.03); padding:15px; border-radius:20px; margin-bottom:12px; border:1px solid rgba(255,255,255,0.05);">
                <p style="font-size:12px; color:var(--gray);">Produk: <b id="d-title" style="color:white;"></b></p>
                <p style="font-size:14px; color:var(--primary); margin-top:5px;">Harga: <b id="d-price"></b></p>
            </div>
            <div class="item-get-box">
                <span class="item-get-title">ITEM YANG DI DAPAT:</span>
                <ul class="item-list" id="d-items"></ul>
            </div>
            <input type="text" id="buyer-name" class="form-control" placeholder="Nama Pembeli">
            <div class="payment-dana-box">
                <div class="dana-logo" id="d-wallet-label">DANA</div>
                <div class="dana-info">
                    <p id="d-wallet-text">TRANSFER KE DANA:</p>
                    <b id="d-wa-payment">0831-2955-5763</b>
                </div>
            </div>
            <button onclick="pushOrderToFirebase()" style="background:var(--primary); color:white; width:100%; padding:16px; border-radius:18px; border:none; font-weight:800;">Beli via WhatsApp</button>
            <button onclick="closeModalGeneric('modal-detail')" style="width:100%; background:none; border:none; color:var(--gray); margin-top:15px;">Kembali</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

    <script>
        window.addEventListener('load', () => { setTimeout(() => { document.getElementById('splash-screen').classList.add('hide-splash'); }, 1800); });

        const firebaseConfig = {
            apiKey: "AIzaSyC9_F1HGMru6vVdBlTqdxfJ-_6wb9CFSyU",
            authDomain: "noxpay-admin.firebaseapp.com",
            databaseURL: "https://noxpay-admin-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "noxpay-admin"
        };
        firebase.initializeApp(firebaseConfig);
        const rdb = firebase.database();
        const fs = firebase.firestore();
        const auth = firebase.auth();

        let myID = "";
        let selectedProduct = null;
        let currentAudio = null;
        let currentIdx = null;
        let creatorsList = {};

        async function syncUser() {
            let localID = localStorage.getItem('uID');
            if (!localID) {
                myID = "USER-" + Math.floor(100000 + Math.random() * 900000);
                localStorage.setItem('uID', myID);
                await fs.collection("users").doc(myID).set({ id: myID, createdAt: new Date().toISOString() });
            } else { myID = localID; }
            document.getElementById('user-id-display').innerText = myID;
            loadCreatorsFromFirebase();
            monitorStatus(); 
        }

        async function loadCreatorsFromFirebase() {
            const listRender = document.getElementById('creator-list-render');
            try {
                fs.collection("users")
                  .where("role", "==", "creator")
                  .where("isApproved", "==", true) 
                  .onSnapshot((snapshot) => {
                    if (snapshot.empty) {
                        listRender.innerHTML = '<p style="color:var(--gray); font-size:12px; text-align:center; grid-column: span 2;">Belum ada creator terverifikasi.</p>';
                        return;
                    }
                    listRender.innerHTML = '';
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const artistName = data.artistName || "Unknown Artist";
                        const avatar = `https://api.dicebear.com/7.x/notionists/svg?seed=${artistName}&backgroundColor=b6e3f4`;
                        
                        creatorsList[artistName] = { 
                            whatsapp: data.whatsapp || "6283129555763", 
                            creatorID: doc.id, 
                            projects: [] 
                        };
                        listRender.innerHTML += `<div class="creator-card" onclick="showProjects('${artistName}', '${avatar}')"><div class="avatar-wrapper"><img src="${avatar}"></div><b style="color:white;">${artistName}</b></div>`;
                    });
                });
            } catch (e) { console.error("Error loading creators:", e); }
        }

        function showCreators() {
            if(currentAudio) { currentAudio.pause(); currentAudio = null; }
            document.getElementById('project-section').classList.add('hidden');
            document.getElementById('creator-section').classList.remove('hidden');
        }

        async function showProjects(name, avatarUrl) {
            document.getElementById('creator-section').classList.add('hidden');
            document.getElementById('project-section').classList.remove('hidden');
            document.getElementById('creator-name-display').innerText = name;
            const btnBaca = document.getElementById('btn-baca-info');
            if(name === 'Rizz_1') { btnBaca.style.display = 'block'; } else { btnBaca.style.display = 'none'; }
            const render = document.getElementById('project-render');
            render.innerHTML = '<p style="text-align:center; font-size:12px; color:var(--gray); margin-top:20px;">Memuat project...</p>';
            
            const currentUID = auth.currentUser ? auth.currentUser.uid : myID;

            try {
                // Gunakan listener Realtime Database untuk mengecek kepemilikan secara real-time
                rdb.ref('orders').on('value', (allOrdersSnap) => {
                    const allOrders = allOrdersSnap.val() || {};
                    
                    fs.collection("projects").where("creatorName", "==", name).get().then(snapshot => {
                        if (snapshot.empty) { render.innerHTML = '<p style="text-align:center; font-size:12px; color:var(--gray); margin-top:20px;">Belum ada project.</p>'; return; }
                        
                        render.innerHTML = '';
                        let i = 0;

                        snapshot.forEach(doc => {
                            const p = doc.data();
                            const pID = doc.id;
                            const type = p.productType || 'reguler'; 
                            const displayTitle = p.productName || p.name;
                            
                            let isSold = false;
                            let belongsToMe = false;

                            // Cek di tabel orders apakah product ini sudah sukses/selesai
                            Object.values(allOrders).forEach(order => {
                                if(order.productID === pID && (order.status === "Success" || order.status === "Selesai")) {
                                    if(type === 'exclusive') isSold = true;
                                    // Cek apakah userID di order cocok dengan User ID saat ini
                                    if(order.userID === currentUID) belongsToMe = true;
                                }
                            });

                            const cardExtraClass = (type === 'exclusive') ? "card-exclusive" : "";
                            const finalSoldClass = (isSold && !belongsToMe) ? 'is-sold-out' : '';

                            let bars = '';
                            for(let b=0; b<25; b++) { bars += `<div class="wave-bar bar-${i}"></div>`; }
                            
                            const projectHTML = `
                            <div class="project-card ${cardExtraClass} ${finalSoldClass}" id="card-${pID}" style="animation-delay: ${i * 0.1}s">
                                <div class="new-badge">${type.toUpperCase()}</div>
                                <div class="card-main-info">
                                    <div class="project-img-container">
                                        <div class="project-img-box"><img src="${avatarUrl}"></div>
                                    </div>
                                    <div class="project-info">
                                        <b>${displayTitle}</b>
                                        <span>${type === 'free' ? 'GRATIS' : 'Rp ' + p.price}</span>
                                    </div>
                                    <div id="btn-box-${pID}">
                                        ${(isSold && !belongsToMe) ? 
                                            `<button class="btn-buy btn-sold-out">Sold Out</button>` : 
                                            `<button class="btn-buy" onclick="openOrder('${name}', '${displayTitle}', '${p.price}', '${pID}', '${JSON.stringify(p.items || [])}', '${p.walletType || 'DANA'}', '${p.walletNumber || ''}')">${type === 'free' ? 'Free' : 'Beli'}</button>`
                                        }
                                    </div>
                                </div>
                                <div class="player-controls" id="player-container-${i}">
                                    <button class="play-btn-mini" onclick="playPreview('${p.audio}', ${i})" id="play-icon-${i}">
                                        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                    </button>
                                    <div class="waveform-container" id="waveform-${i}" onclick="seekAudioFromWave(event, ${i})">${bars}</div>
                                    <span class="time-display" id="time-${i}">0:00</span>
                                </div>
                            </div>`;
                            
                            render.insertAdjacentHTML('beforeend', projectHTML);
                            
                            // Jika memang milik saya, ganti ke tombol download secara permanen
                            if(belongsToMe || type === 'free') {
                                setDownloadButton(pID);
                            }
                            i++;
                        });
                    });
                });
            } catch (e) { render.innerHTML = '<p style="text-align:center; font-size:12px; color:var(--accent-new); margin-top:20px;">Gagal memuat data.</p>'; }
        }

        function setDownloadButton(pID) {
            const btnBox = document.getElementById(`btn-box-${pID}`);
            if(!btnBox) return;
            
            fs.collection("projects").doc(pID).get().then(doc => {
                if(doc.exists) {
                    const data = doc.data();
                    const link = data.fileLink || data.fileUrl || data.link;
                    if(link) {
                        btnBox.innerHTML = `
                            <a href="${link}" target="_blank" class="btn-download-premium">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                            </a>`;
                        
                        const card = document.getElementById(`card-${pID}`);
                        if(card) {
                            card.classList.remove('is-sold-out');
                            card.style.filter = "none";
                            card.style.opacity = "1";
                            card.style.pointerEvents = "auto";
                        }
                    }
                }
            });
        }

        function playPreview(src, index) {
            if (currentIdx === index && currentAudio) {
                if (currentAudio.paused) { 
                    currentAudio.play().catch(e => console.log("Playback failed:", e)); 
                    updateIcon(index, true); 
                    document.getElementById(`player-container-${index}`).classList.add('playing'); 
                } else { 
                    currentAudio.pause(); 
                    updateIcon(index, false); 
                    document.getElementById(`player-container-${index}`).classList.remove('playing'); 
                }
                return;
            }
            if (currentAudio) { 
                currentAudio.pause(); 
                updateIcon(currentIdx, false); 
                const oldContainer = document.getElementById(`player-container-${currentIdx}`);
                if(oldContainer) oldContainer.classList.remove('playing'); 
                document.querySelectorAll(`.bar-${currentIdx}`).forEach(b => b.classList.remove('active'));
            }
            currentAudio = new Audio(src);
            currentIdx = index;
            currentAudio.play().catch(e => console.log("Playback started:", e));
            updateIcon(index, true);
            const currentContainer = document.getElementById(`player-container-${index}`);
            if(currentContainer) currentContainer.classList.add('playing');
            currentAudio.ontimeupdate = () => {
                const time = document.getElementById(`time-${index}`);
                if(time) time.innerText = formatTime(currentAudio.currentTime);
                const bars = document.querySelectorAll(`.bar-${index}`);
                const progress = (currentAudio.currentTime / (currentAudio.duration || 1)) * bars.length;
                bars.forEach((bar, bIdx) => {
                    if(bIdx < progress) bar.classList.add('active');
                    else bar.classList.remove('active');
                });
            };
            currentAudio.onended = () => { 
                updateIcon(index, false); 
                const container = document.getElementById(`player-container-${index}`);
                if(container) container.classList.remove('playing'); 
                document.querySelectorAll(`.bar-${index}`).forEach(b => b.classList.remove('active'));
            };
        }

        function seekAudioFromWave(e, index) { 
            if (currentIdx !== index || !currentAudio) return; 
            const container = document.getElementById(`waveform-${index}`); 
            const rect = container.getBoundingClientRect(); 
            const x = e.clientX - rect.left; 
            const targetTime = (x / rect.width) * currentAudio.duration;
            if(!isNaN(targetTime)) currentAudio.currentTime = targetTime; 
        }

        function updateIcon(idx, isPlaying) { 
            const icon = document.getElementById('play-icon-' + idx); 
            if(!icon) return; 
            icon.innerHTML = isPlaying ? '<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>' : '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>'; 
        }

        function formatTime(sec) { 
            if(isNaN(sec)) return "0:00";
            let m = Math.floor(sec / 60); 
            let s = Math.floor(sec % 60); 
            return `${m}:${s < 10 ? '0' : ''}${s}`; 
        }
        
        function openOrder(creator, name, price, id, itemsJson, wType, wNum) { 
            const items = JSON.parse(itemsJson || "[]");
            selectedProduct = { creator, name, price, id, items }; 
            document.getElementById('d-title').innerText = name; 
            document.getElementById('d-price').innerText = price == 0 ? "GRATIS" : "Rp " + price; 
            const finalWalletNum = wNum || (creatorsList[creator]?.whatsapp || "083129555763").replace('62', '0');
            const finalWalletType = wType || "DANA";
            document.getElementById('d-wallet-label').innerText = finalWalletType;
            document.getElementById('d-wallet-text').innerText = `TRANSFER KE ${finalWalletType}:`;
            document.getElementById('d-wa-payment').innerText = finalWalletNum;
            const itemRender = document.getElementById('d-items');
            itemRender.innerHTML = '';
            if(items.length > 0) { items.forEach(item => { itemRender.innerHTML += `<li>${item}</li>`; }); }
            else { itemRender.innerHTML = '<li>Project .Flm</li><li>High Quality Audio</li>'; }
            document.getElementById('modal-detail').style.display = 'flex'; 
        }
        
        async function pushOrderToFirebase() {
            const bName = document.getElementById('buyer-name').value;
            if(!bName) return alert("Isi nama dulu!");
            
            const currentUID = auth.currentUser ? auth.currentUser.uid : myID;
            const trxID = "TRX-" + Date.now();
            const now = new Date();
            const tanggalFull = now.toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' });
            const waktuFull = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            const creatorData = creatorsList[selectedProduct.creator];
            const targetWA = creatorData?.whatsapp || "6283129555763";
            const cID = creatorData?.creatorID || "ADMIN";

            await rdb.ref('orders/' + trxID).set({ 
                orderID: trxID,
                userID: currentUID,            
                creatorID: cID,          
                buyerName: bName, 
                product: selectedProduct.name, 
                productID: selectedProduct.id, 
                nominal: selectedProduct.price, 
                status: "Pending", 
                tanggal: tanggalFull, 
                jam: waktuFull, 
                creatorName: selectedProduct.creator 
            });

            const pesanWA = `*INVOICE PESANAN - NOXPAY*%0A----------------------------------------%0AðŸ‘¤ *Nama:* ${bName}%0AðŸ†” *User ID:* ${currentUID}%0AðŸ“¦ *Produk:* ${selectedProduct.name}%0AðŸ’° *Harga:* ${selectedProduct.price == 0 ? 'GRATIS' : 'Rp ' + selectedProduct.price}%0Aâ° *Waktu:* ${tanggalFull} (${waktuFull})%0A----------------------------------------%0A_Mohon segera diproses Creator!_`;
            window.open(`https://wa.me/${targetWA}?text=${pesanWA}`, '_blank');
            closeModalGeneric('modal-detail');
        }

        // FUNGSI UTAMA MONITORING REAL-TIME AGAR TOMBOL PERMANEN
        function monitorStatus() {
            rdb.ref('orders').on('value', (snap) => {
                if(!snap.exists()) return;
                const currentUID = auth.currentUser ? auth.currentUser.uid : myID;
                
                snap.forEach(child => {
                    const orderData = child.val();
                    // Jika order milik saya SUDAH dikonfirmasi (Success/Selesai)
                    if(orderData.userID === currentUID && (orderData.status === "Success" || orderData.status === "Selesai")) {
                        // Pastikan tombol berubah seketika tanpa refresh
                        setDownloadButton(orderData.productID);
                    }
                });
            });
        }

        function monitorIncomingOrders(creatorUID) {
            rdb.ref('orders').orderByChild('creatorID').equalTo(creatorUID).on('value', (snap) => {
                let hasPending = false;
                if(snap.exists()){
                    snap.forEach(child => {
                        if(child.val().status === "Pending") {
                            hasPending = true;
                        }
                    });
                }
                
                const dotHeader = document.getElementById('dot-header');
                const dotDashboard = document.getElementById('dot-dashboard');
                
                if(hasPending) {
                    if(dotHeader) dotHeader.style.display = 'block';
                    if(dotDashboard) dotDashboard.style.display = 'block';
                } else {
                    if(dotHeader) dotHeader.style.display = 'none';
                    if(dotDashboard) dotDashboard.style.display = 'none';
                }
            });
        }

        function toggleSidebarCreator() { const sb = document.getElementById('creator-sidebar'); const overlay = document.getElementById('sidebar-overlay-creator'); if(sb.classList.contains('active')) { sb.classList.remove('active'); overlay.style.opacity = '0'; setTimeout(() => overlay.style.display = 'none', 300); } else { overlay.style.display = 'block'; setTimeout(() => { sb.classList.add('active'); overlay.style.opacity = '1'; }, 10); } }
        function closeModalGeneric(id) { document.getElementById(id).style.display = 'none'; }
        function openInfoBox() { document.getElementById('modal-info').style.display = 'flex'; }
        function handleLogout() { if(confirm("Keluar dari akun?")) { auth.signOut().then(() => location.reload()); } }
        function copyID() { const id = document.getElementById('user-id-display').innerText; navigator.clipboard.writeText(id); alert("ID disalin!"); }

        syncUser();

        auth.onAuthStateChanged((user) => {
            const ui = {
                btnDaftar: document.getElementById('btn-daftar'),
                btnUpload: document.getElementById('btn-upload'),
                btnLogout: document.getElementById('btn-logout'),
                displayID: document.getElementById('user-id-display'),
                name: document.getElementById('sidebar-user-name'),
                role: document.getElementById('sidebar-user-role'),
                avatar: document.getElementById('sidebar-avatar'),
                menuDashboard: document.getElementById('menu-dashboard') 
            };
            if (user) {
                if(ui.displayID) ui.displayID.innerText = user.uid;
                if(ui.btnLogout) ui.btnLogout.style.display = 'block';
                
                fs.collection("users").doc(user.uid).onSnapshot((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        const artistName = data.artistName || "User NoxPay";
                        if(ui.name) ui.name.innerText = artistName;
                        if(ui.avatar) ui.avatar.src = `https://api.dicebear.com/7.x/notionists/svg?seed=${artistName}&backgroundColor=b6e3f4`;
                        
                        if (data.isApproved === true) {
                            if(ui.role) ui.role.innerText = "OFFICIAL ARTIST";
                            if(ui.btnDaftar) ui.btnDaftar.style.display = 'none';
                            if(ui.btnUpload) ui.btnUpload.style.display = 'block';
                            if(ui.menuDashboard) ui.menuDashboard.style.display = 'flex';
                            
                            monitorIncomingOrders(user.uid);
                        } else {
                            if(ui.role) ui.role.innerText = "PENDING CREATOR";
                            if(ui.btnDaftar) ui.btnDaftar.style.display = 'block';
                            if(ui.btnUpload) ui.btnUpload.style.display = 'none';
                            if(ui.menuDashboard) ui.menuDashboard.style.display = 'none';
                        }
                    }
                });
                monitorStatus(); 
            } else {
                if(ui.displayID) ui.displayID.innerText = myID; 
                if(ui.name) ui.name.innerText = "Guest User";
                if(ui.role) ui.role.innerText = "MEMBER";
                if(ui.btnDaftar) ui.btnDaftar.style.display = 'block';
                if(ui.btnUpload) ui.btnUpload.style.display = 'none';
                if(ui.btnLogout) ui.btnLogout.style.display = 'none';
                if(ui.menuDashboard) ui.menuDashboard.style.display = 'none';
                if(ui.avatar) ui.avatar.src = `https://api.dicebear.com/7.x/notionists/svg?seed=Guest&backgroundColor=b6e3f4`;
            }
        });
    </script>
</body>
</html>

